# Initial Prompt
I have this caddy config that rewrite /script.js and /api/send:  # Proxy /script.js to the remote Umami script
    @umamijs {
        path /script.js
        path /api/send
    }
    reverse_proxy @umamijs https://cloud.umami.is {
        # Ensure the Host header is correct
        header_up Host cloud.umami.is
    }. Investigate how to include this as a server route in the analytics plugin so the caddy configuration is not needed anymore. The https://cloud.umami.is value should be exposed as a runtime property

# Implementation Summary
Added an analytics-layer server middleware that proxies `/script.js` and `/api/send` to a configurable Umami host, removing the need for external Caddy rewrites.

# Documentation Overview
- Introduced a private runtime config (`runtimeConfig.analytics.umami.proxyHost`) defaulting to the hosted Umami endpoint.
- Implemented `server/middleware/umami-proxy.ts` that intercepts the script and send routes, forwarding the request through `proxyRequest` with the correct upstream host header.
- Client-side plugin still loads `/script.js`; the middleware now serves it locally while relaying to the remote host.

# Implementation Examples
- `layers/analytics/nuxt.config.ts`
  ```ts
  runtimeConfig: {
    analytics: {
      umami: {
        proxyHost: "https://analytics.umami.is",
      },
    },
    public: { â€¦ }
  }
  ```
- `layers/analytics/server/middleware/umami-proxy.ts`
  ```ts
  const target = new URL(path, base)
  return proxyRequest(event, target.toString(), {
    fetchOptions: { headers: { host: target.host } },
  })
  ```
